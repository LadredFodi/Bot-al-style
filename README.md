# Автоматизированный парсер-бот для al-style.kz

Интеллектуальный веб-автоматизатор для управления товарами со скидкой на сайте al-style.kz. Бот автоматически добавляет доступные товары со скидкой в корзину с учетом их количества и предотвращением дубликатов.

## Возможности

### Основные функции
- **Автоматическая авторизация** на сайте al-style.kz
- **Интеллектуальная навигация** по категориям и подкатегориям товаров
- **Автоматическое добавление товаров со скидкой** в корзину с учетом доступного количества
- **Предотвращение дубликатов** через проверку API корзины
- **Поддержка headless и обычного режимов** работы браузера

### Продвинутые возможности
- **Умное обнаружение и скрытие оверлеев** и всплывающих окон
- **Множественные методы клика** (обычный клик, JavaScript, ActionChains)
- **Адаптивные задержки** для headless и обычного режимов
- **Автоматическое развертывание категорий** товаров
- **Обработка markdown-ссылок** с настраиваемой логикой кликов
- **Робастная обработка ошибок** с автоматическими повторными попытками
- **Детальное логирование** всех операций с возможностью отладки

## Требования

### Системные требования
- **Python 3.12+**
- **Google Chrome** (последняя версия)


## Настройка

### 1. Клонирование и подготовка окружения

```bash
# Клонирование репозитория
git clone <repository-url>
cd parseraboba

# Создание виртуального окружения
python -m venv venv

# Активация виртуального окружения
# Linux/MacOS:
source venv/bin/activate
# Windows:
.\venv\Scripts\activate
```

### 2. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 3. Конфигурация

Создайте файл `.env` в корневой директории проекта:

```env
# Обязательные параметры
TOKEN=ваш_api_токен_для_корзины
BASE_URL=https://api.al-style.kz
TARGET_URL=https://api.al-style.kz
USERNAME=ваш_логин
PASSWORD=ваш_пароль
```

## Использование

### Быстрый старт

```bash
python main.py
```

### Режимы работы

Бот поддерживает два режима работы, которые настраиваются в `config.py`:

#### Headless режим (по умолчанию)
```python
HEADLESS_MODE = True  # Невидимый браузер, подходит для серверов
```

#### Обычный режим (для отладки)
```python
HEADLESS_MODE = False  # Видимый браузер, удобно для разработки
```

### Настройка задержек

В файле `config.py` доступны следующие настройки задержек:

```python
CLICK_DELAY = 0.3           # Задержка между кликами
SHORT_DELAY = 0.2           # Короткая задержка
MEDIUM_DELAY = 0.3          # Средняя задержка для скроллинга
STANDARD_DELAY = 0.5        # Стандартная задержка
PAGE_LOAD_DELAY = 2         # Задержка загрузки страницы
LONG_DELAY = 3              # Длинная задержка для сложных операций

# Дополнительные задержки для headless режима
HEADLESS_EXTRA_DELAY = 1    # Дополнительная задержка для headless режима
HEADLESS_PAGE_LOAD = 5      # Время загрузки страниц в headless режиме
```

### Отладка

Для настройки уровня логирования измените параметр level в main.py:

```python
logging.basicConfig(
    level=logging.DEBUG,  # Для детального логирования
    # level=logging.INFO,  # Для основной информации
    # level=logging.WARNING,  # Только для предупреждений и ошибок
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    datefmt='%Y-%m-%d %H:%M:%S'
)
```

## Алгоритм работы

1. **Инициализация** - Запуск браузера с оптимизированными настройками
2. **Тестирование совместимости** - Проверка работы headless режима
3. **Авторизация** - Автоматический вход на сайт
4. **Навигация** - Переход на целевую страницу и закрытие модальных окон
5. **Обработка категорий** - Развертывание всех категорий товаров
6. **Обработка ссылок** - Клик по markdown-ссылкам с умной логикой
7. **Добавление товаров** - Автоматическое добавление товаров со скидкой:
   - Проверка наличия товара в корзине через API
   - Определение доступного количества
   - Добавление с учетом количества
   - Пропуск дубликатов


## API интеграция

Бот использует API al-style.kz для:
- **Получения списка товаров в корзине** (`/cart-api/get`)
- **Предотвращения дубликатов** при добавлении товаров

## Обработка ошибок

### Автоматическое восстановление
- **Множественные попытки** для критических операций
- **Автоматическое скрытие** перекрывающих элементов
- **Альтернативные методы** клика при неудачах

### Логирование и отладка
- **Подробные логи** всех операций
- **Скриншоты ошибок** сохраняются как `error_screenshot.png`
- **Цветовая индикация** статуса операций в логах

### Типичные проблемы
- **ChromeDriver не найден** - Убедитесь в правильной установке
- **Ошибки авторизации** - Проверьте данные в `.env` файле
- **Timeout ошибки** - Увеличьте задержки в `config.py`

## Безопасность

- **Имитация человеческого поведения** через случайные задержки
- **Антидетекционные меры** для WebDriver
- **Защищенное хранение** учетных данных в `.env`

## Производительность

### Оптимизации браузера
- Отключение изображений и медиа
- Отключение уведомлений и геолокации
- Оптимизированные настройки Chrome

### Headless режим
- Ускоренная работа без GUI
- Подходит для развертывания на серверах
- Автоматические дополнительные задержки для стабильности

## Деактивация окружения

```bash
deactivate
```
